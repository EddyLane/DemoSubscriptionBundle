<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns ="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>Behat Test Suite</title>
    <style type="text/css">
        body {
            margin:0px;
            padding:0px;
            position:relative;
            padding-top:75px;
        }
        #behat {
            float:left;
            font-family: Georgia, serif;
            font-size:18px;
            line-height:26px;
            width:100%;
        }
        #behat .statistics {
            float:left;
            width:100%;
            margin-bottom:15px;
        }
        #behat .statistics p {
            text-align:right;
            padding:5px 15px;
            margin:0px;
            border-right:10px solid #000;
        }
        #behat .statistics.failed p {
            border-color:#C20000;
        }
        #behat .statistics.passed p {
            border-color:#3D7700;
        }
        #behat .feature {
            margin:15px;
        }
        #behat h2, #behat h3, #behat h4 {
            margin:0px 0px 5px 0px;
            padding:0px;
            font-family:Georgia;
        }
        #behat h2 .title, #behat h3 .title, #behat h4 .title {
            font-weight:normal;
        }
        #behat .path {
            font-size:10px;
            font-weight:normal;
            font-family: 'Bitstream Vera Sans Mono', 'DejaVu Sans Mono', Monaco, Courier, monospace !important;
            color:#999;
            padding:0px 5px;
            float:right;
        }
        #behat .path a:link,
        #behat .path a:visited {
            color:#999;
        }
        #behat .path a:hover,
        #behat .path a:active {
            background-color:#000;
            color:#fff;
        }
        #behat h3 .path {
            margin-right:4%;
        }
        #behat ul.tags {
            font-size:14px;
            font-weight:bold;
            color:#246AC1;
            list-style:none;
            margin:0px;
            padding:0px;
        }
        #behat ul.tags li {
            display:inline;
        }
        #behat ul.tags li:after {
            content:' ';
        }
        #behat ul.tags li:last-child:after {
            content:'';
        }
        #behat .feature > p {
            margin-top:0px;
            margin-left:20px;
        }
        #behat .scenario {
            margin-left:20px;
            margin-bottom:20px;
        }
        #behat .scenario > ol,
        #behat .scenario .examples > ol {
            margin:0px;
            list-style:none;
            padding:0px;
        }
        #behat .scenario > ol {
            margin-left:20px;
        }
        #behat .scenario > ol:after,
        #behat .scenario .examples > ol:after {
            content:'';
            display:block;
            clear:both;
        }
        #behat .scenario > ol li,
        #behat .scenario .examples > ol li {
            float:left;
            width:95%;
            padding-left:5px;
            border-left:5px solid;
            margin-bottom:4px;
        }
        #behat .scenario > ol li .argument,
        #behat .scenario .examples > ol li .argument {
            margin:10px 20px;
            font-size:16px;
            overflow:hidden;
        }
        #behat .scenario > ol li table.argument,
        #behat .scenario .examples > ol li table.argument {
            border:1px solid #d2d2d2;
        }
        #behat .scenario > ol li table.argument thead td,
        #behat .scenario .examples > ol li table.argument thead td {
            font-weight: bold;
        }
        #behat .scenario > ol li table.argument td,
        #behat .scenario .examples > ol li table.argument td {
            padding:5px 10px;
            background:#f3f3f3;
        }
        #behat .scenario > ol li .keyword,
        #behat .scenario .examples > ol li .keyword {
            font-weight:bold;
        }
        #behat .scenario > ol li .path,
        #behat .scenario .examples > ol li .path {
            float:right;
        }
        #behat .scenario .examples {
            margin-top:20px;
            margin-left:40px;
        }
        #behat .scenario .examples h4 span {
            font-weight:normal;
            background:#f3f3f3;
            color:#999;
            padding:0 5px;
            margin-left:10px;
        }
        #behat .scenario .examples table {
            margin-left:20px;
        }
        #behat .scenario .examples table thead td {
            font-weight:bold;
            text-align:center;
        }
        #behat .scenario .examples table td {
            padding:2px 10px;
            font-size:16px;
        }
        #behat .scenario .examples table .failed.exception td {
            border-left:5px solid #000;
            border-color:#C20000 !important;
            padding-left:0px;
        }
        pre {
            font-family:monospace;
        }
        .snippet {
            font-size:14px;
            color:#000;
            margin-left:20px;
        }
        .backtrace {
            font-size:12px;
            line-height:18px;
            color:#000;
            overflow:hidden;
            margin-left:20px;
            padding:15px;
            border-left:2px solid #C20000;
            background: #fff;
            margin-right:15px;
        }
        #behat .passed {
            background:#DBFFB4;
            border-color:#65C400 !important;
            color:#3D7700;
        }
        #behat .failed {
            background:#FFFBD3;
            border-color:#C20000 !important;
            color:#C20000;
        }
        #behat .undefined, #behat .pending {
            border-color:#FAF834 !important;
            background:#FCFB98;
            color:#000;
        }
        #behat .skipped {
            background:lightCyan;
            border-color:cyan !important;
            color:#000;
        }
        #behat .summary {
            position: absolute;
            top: 0px;
            left: 0px;
            width:100%;
            font-family: Arial, sans-serif;
            font-size: 14px;
            line-height: 18px;
        }
        #behat .summary .counters {
            padding: 10px;
            border-top: 0px;
            border-bottom: 0px;
            border-right: 0px;
            border-left: 5px;
            border-style: solid;
            height: 52px;
            overflow: hidden;
        }
        #behat .summary .switchers {
            position: absolute;
            right: 15px;
            top: 25px;
        }
        #behat .summary .switcher {
            text-decoration: underline;
            cursor: pointer;
        }
        #behat .summary .switchers a {
            margin-left: 10px;
            color: #000;
        }
        #behat .summary .switchers a:hover {
            text-decoration:none;
        }
        #behat .summary p {
            margin:0px;
        }
        #behat .jq-toggle > .scenario,
        #behat .jq-toggle > ol,
        #behat .jq-toggle > .examples {
            display:none;
        }
        #behat .jq-toggle-opened > .scenario,
        #behat .jq-toggle-opened > ol,
        #behat .jq-toggle-opened > .examples {
            display:block;
        }
        #behat .jq-toggle > h2,
        #behat .jq-toggle > h3 {
            cursor:pointer;
        }
        #behat .jq-toggle > h2:after,
        #behat .jq-toggle > h3:after {
            content:' |+';
            font-weight:bold;
        }
        #behat .jq-toggle-opened > h2:after,
        #behat .jq-toggle-opened > h3:after {
            content:' |-';
            font-weight:bold;
        }
    </style>

    <style type="text/css" media="print">
        body {
            padding:0px;
        }

        #behat {
            font-size:11px;
        }

        #behat .jq-toggle > .scenario,
        #behat .jq-toggle > .scenario .examples,
        #behat .jq-toggle > ol {
            display:block;
        }

        #behat .summary {
            position:relative;
        }

        #behat .summary .counters {
            border:none;
        }

        #behat .summary .switchers {
            display:none;
        }

        #behat .step .path {
            display:none;
        }

        #behat .jq-toggle > h2:after,
        #behat .jq-toggle > h3:after {
            content:'';
            font-weight:bold;
        }

        #behat .jq-toggle-opened > h2:after,
        #behat .jq-toggle-opened > h3:after {
            content:'';
            font-weight:bold;
        }

        #behat .scenario > ol li,
        #behat .scenario .examples > ol li {
            border-left:none;
        }
    </style>
</head>
<body>
    <div id="behat">
        
<div class="feature">
<ul class="tags">
<li>@card</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">DELETE delete_user_card single</span>
</h2>

<div class="scenario background">
<h3>
<span class="keyword">Background: </span>
<span class="path">features/delete-card.feature:4</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following users exist in the system:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingUsersExistInTheSystem()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>username</td>
<td>email</td>
<td>password</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>bob</td>
<td>bob</td>
<td>bob</td>
</tr>
<tr class="row">
<td>john</td>
<td>john</td>
<td>john</td>
</tr>
<tr class="row">
<td>fridge</td>
<td>fridge</td>
<td>fridge</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the user "<strong class="passed_param">fridge</strong>" is an admin</span>
<span class="path">Acceptance\Context\Data\DataContext::theUserIsAnAdmin()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-type</strong>" with value "<strong class="passed_param">application/json</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 when successful</span>
<span class="path">features/delete-card.feature:13</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the following cards should exist for user "<strong class="passed_param">bob</strong>":</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingCardsShouldExistForUserBob()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>id</td>
<td>number</td>
<td>cardType</td>
<td>expYear</td>
<td>expMonth</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>1</td>
<td>**** **** **** 4242</td>
<td>1</td>
<td>2014</td>
<td>7</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the card with id <strong class="passed_param">1</strong> should have been persisted to stripe for user "<strong class="passed_param">bob</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::theCardWithIdShouldHaveBeen()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">DELETE</strong> request to "<strong class="passed_param">/users/bob/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">print response</span>
<span class="path">Acceptance\Context\Web\WebContext::printResponse()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;card_type_name&quot;:&quot;Visa&quot;,
    &quot;number&quot;:&quot;**** **** **** 4242&quot;
    ,&quot;exp_month&quot;:7,
    &quot;exp_year&quot;:2014,
    &quot;default&quot;:true
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">no cards should exist in the system</span>
<span class="path">Acceptance\Context\Data\DataContext::noCardsShouldExistInTheSystem()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 403 when not user and not admin</span>
<span class="path">features/delete-card.feature:40</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">fridge</strong>" with "<strong class="passed_param">fridge</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/john/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">DELETE</strong> request to "<strong class="passed_param">/users/john/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;Access Denied&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 when not user and is admin</span>
<span class="path">features/delete-card.feature:57</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">fridge</strong>" with "<strong class="passed_param">fridge</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">DELETE</strong> request to "<strong class="passed_param">/users/bob/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;card_type_name&quot;:&quot;Visa&quot;,
    &quot;number&quot;:&quot;**** **** **** 4242&quot;
    ,&quot;exp_month&quot;:7,
    &quot;exp_year&quot;:2014,
    &quot;default&quot;:true
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 404 when no user exists</span>
<span class="path">features/delete-card.feature:77</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">DELETE</strong> request to "<strong class="passed_param">/users/missing/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">404</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:404,
    &quot;message&quot;:&quot;&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 404 when no card exists</span>
<span class="path">features/delete-card.feature:93</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">DELETE</strong> request to "<strong class="passed_param">/users/bob/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">404</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:404,
    &quot;message&quot;:&quot;&quot;
}</pre>
</li>
</ol>
</div>
</div>
<div class="feature">
<ul class="tags">
<li>@card</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">GET get_user_card single</span>
</h2>

<div class="scenario background">
<h3>
<span class="keyword">Background: </span>
<span class="path">features/get-card.feature:4</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following users exist in the system:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingUsersExistInTheSystem()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>username</td>
<td>email</td>
<td>password</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>bob</td>
<td>bob</td>
<td>bob</td>
</tr>
<tr class="row">
<td>john</td>
<td>john</td>
<td>john</td>
</tr>
<tr class="row">
<td>fridge</td>
<td>fridge</td>
<td>fridge</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the user "<strong class="passed_param">fridge</strong>" is an admin</span>
<span class="path">Acceptance\Context\Data\DataContext::theUserIsAnAdmin()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-type</strong>" with value "<strong class="passed_param">application/json</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 when logged in</span>
<span class="path">features/get-card.feature:13</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/bob/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">    {
        &quot;card_type_name&quot;:&quot;Visa&quot;,
        &quot;number&quot;:&quot;**** **** **** 4242&quot;,
        &quot;exp_month&quot;:7,
        &quot;exp_year&quot;:2014,
        &quot;id&quot;:1,
        &quot;default&quot;: true
    }</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 403 when not user and not admin</span>
<span class="path">features/get-card.feature:33</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">fridge</strong>" with "<strong class="passed_param">fridge</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/john/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/john/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;Access Denied&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 when not user and is admin</span>
<span class="path">features/get-card.feature:50</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">fridge</strong>" with "<strong class="passed_param">fridge</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/bob/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">    {
        &quot;card_type_name&quot;:&quot;Visa&quot;,
        &quot;number&quot;:&quot;**** **** **** 4242&quot;,
        &quot;exp_month&quot;:7,
        &quot;exp_year&quot;:2014,
        &quot;id&quot;:1,
        &quot;default&quot;: true
    }</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 404 when no user exists</span>
<span class="path">features/get-card.feature:70</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/missing/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">404</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:404,
    &quot;message&quot;:&quot;&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 404 when no card exists</span>
<span class="path">features/get-card.feature:86</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/bob/cards/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">404</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:404,
    &quot;message&quot;:&quot;&quot;
}</pre>
</li>
</ol>
</div>
</div>
<div class="feature">
<ul class="tags">
<li>@card</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">GET get_user_cards</span>
</h2>

<div class="scenario background">
<h3>
<span class="keyword">Background: </span>
<span class="path">features/get-cards.feature:4</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following users exist in the system:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingUsersExistInTheSystem()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>username</td>
<td>email</td>
<td>password</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>bob</td>
<td>bob</td>
<td>bob</td>
</tr>
<tr class="row">
<td>john</td>
<td>john</td>
<td>john</td>
</tr>
<tr class="row">
<td>fridge</td>
<td>fridge</td>
<td>fridge</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the user "<strong class="passed_param">fridge</strong>" is an admin</span>
<span class="path">Acceptance\Context\Data\DataContext::theUserIsAnAdmin()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-type</strong>" with value "<strong class="passed_param">application/json</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 when logged in</span>
<span class="path">features/get-cards.feature:13</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/bob/cards</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">    [
        {
            &quot;card_type_name&quot;:&quot;Visa&quot;,
            &quot;number&quot;:&quot;**** **** **** 4242&quot;,
            &quot;exp_month&quot;:7,
            &quot;exp_year&quot;:2014,
            &quot;id&quot;:1,
            &quot;default&quot;: true
        }
    ]</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 403 when not the user</span>
<span class="path">features/get-cards.feature:35</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/john/cards</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;Access Denied&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 404 when no user exists</span>
<span class="path">features/get-cards.feature:47</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">fridge</strong>" with "<strong class="passed_param">fridge</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/missing/cards</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="passed_param">404</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:404,
    &quot;message&quot;:&quot;&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 when not the user but is an admin</span>
<span class="path">features/get-cards.feature:59</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">fridge</strong>" with "<strong class="passed_param">fridge</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/john/cards</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">[]</pre>
</li>
</ol>
</div>
</div>
<div class="feature">
<ul class="tags">
<li>@subscription</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">GET get_subscription</span>
</h2>

<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 and subscription object</span>
<span class="path">features/get-subscription.feature:4</span>
</h3>
<ol>
<li class="failed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following subscriptions exist:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingSubscriptionsExist()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>name</td>
<td>description</td>
<td>price</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>small</td>
<td>smallest</td>
<td>100</td>
</tr>
</tbody>
</table>
<pre class="backtrace">No such plan: 1</pre>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="skipped_param">GET</strong> request to "<strong class="skipped_param">/subscriptions/1</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="skipped_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;name&quot;:&quot;small&quot;,
    &quot;price&quot;:&quot;100&quot;,
    &quot;description&quot;:&quot;smallest&quot;,
    &quot;id&quot;:1
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 404 when trying to get a subscription which does not exist</span>
<span class="path">features/get-subscription.feature:20</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/subscriptions/2</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">404</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:404,
    &quot;message&quot;:&quot;&quot;
}</pre>
</li>
</ol>
</div>
</div>
<div class="feature">
<ul class="tags">
<li>@subscription</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">GET get_subscriptions</span>
</h2>

<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 and subscription collection</span>
<span class="path">features/get-subscriptions.feature:4</span>
</h3>
<ol>
<li class="failed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following subscriptions exist:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingSubscriptionsExist()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>name</td>
<td>description</td>
<td>price</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>small</td>
<td>smallest</td>
<td>100</td>
</tr>
<tr class="row">
<td>middle</td>
<td>middlest</td>
<td>200</td>
</tr>
<tr class="row">
<td>large</td>
<td>largest</td>
<td>300</td>
</tr>
</tbody>
</table>
<pre class="backtrace">No such plan: 1</pre>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="skipped_param">GET</strong> request to "<strong class="skipped_param">/subscriptions</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="skipped_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">    [
        {
            &quot;name&quot;:&quot;small&quot;,
            &quot;price&quot;:&quot;100&quot;,
            &quot;description&quot;:&quot;smallest&quot;,
            &quot;id&quot;:1
        },
        {   &quot;name&quot;:&quot;middle&quot;,
            &quot;price&quot;:&quot;200&quot;,
            &quot;description&quot;:&quot;middlest&quot;,
            &quot;id&quot;:2
        },
        {
            &quot;name&quot;:&quot;large&quot;,
            &quot;price&quot;:&quot;300&quot;,
            &quot;description&quot;:&quot;largest&quot;,
            &quot;id&quot;:3
        }
    ]</pre>
</li>
</ol>
</div>
</div>
<div class="feature">
<ul class="tags">
<li>@user</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">GET get_user</span>
</h2>

<div class="scenario background">
<h3>
<span class="keyword">Background: </span>
<span class="path">features/get-user.feature:4</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following users exist in the system:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingUsersExistInTheSystem()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>username</td>
<td>email</td>
<td>password</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>bob</td>
<td>bob</td>
<td>bob</td>
</tr>
<tr class="row">
<td>tom</td>
<td>tom</td>
<td>tom</td>
</tr>
<tr class="row">
<td>fridge</td>
<td>fridge</td>
<td>fridge</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the user "<strong class="passed_param">fridge</strong>" is an admin</span>
<span class="path">Acceptance\Context\Data\DataContext::theUserIsAnAdmin()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 403 when not logged in</span>
<span class="path">features/get-user.feature:12</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/bob</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;Not authenticated&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 403 when not user and not admin</span>
<span class="path">features/get-user.feature:23</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">tom</strong>" with "<strong class="passed_param">tom</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/bob</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;Access Denied&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 when not user but is admin</span>
<span class="path">features/get-user.feature:35</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">fridge</strong>" with "<strong class="passed_param">fridge</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/bob</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;username&quot;:&quot;bob&quot;,
    &quot;email&quot;:&quot;bob&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 when user</span>
<span class="path">features/get-user.feature:47</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users/bob</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;username&quot;:&quot;bob&quot;,
    &quot;email&quot;:&quot;bob&quot;
}</pre>
</li>
</ol>
</div>
</div>
<div class="feature">
<ul class="tags">
<li>@user</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">GET get_user</span>
</h2>

<div class="scenario background">
<h3>
<span class="keyword">Background: </span>
<span class="path">features/get-users.feature:4</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following users exist in the system:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingUsersExistInTheSystem()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>username</td>
<td>email</td>
<td>password</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>bob</td>
<td>bob</td>
<td>bob</td>
</tr>
<tr class="row">
<td>tom</td>
<td>tom</td>
<td>tom</td>
</tr>
<tr class="row">
<td>fridge</td>
<td>fridge</td>
<td>fridge</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the user "<strong class="passed_param">fridge</strong>" is an admin</span>
<span class="path">Acceptance\Context\Data\DataContext::theUserIsAnAdmin()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-type</strong>" with value "<strong class="passed_param">application/json</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 403 when not logged in</span>
<span class="path">features/get-users.feature:13</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;Not authenticated&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 403 when not admin</span>
<span class="path">features/get-users.feature:24</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;Access Denied&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 200 when an admin</span>
<span class="path">features/get-users.feature:36</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">fridge</strong>" with "<strong class="passed_param">fridge</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">GET</strong> request to "<strong class="passed_param">/users</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequest()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">[
    {
        &quot;username&quot;:&quot;bob&quot;,
        &quot;email&quot;:&quot;bob&quot;
    },
    {
        &quot;username&quot;:&quot;tom&quot;,
        &quot;email&quot;:&quot;tom&quot;
    },
    {
        &quot;username&quot;:&quot;fridge&quot;,
        &quot;email&quot;:&quot;fridge&quot;
    }
]</pre>
</li>
</ol>
</div>
</div>
<div class="feature">
<ul class="tags">
<li>@card</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">POST post_user_card</span>
</h2>

<div class="scenario background">
<h3>
<span class="keyword">Background: </span>
<span class="path">features/post-card.feature:4</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following users exist in the system:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingUsersExistInTheSystem()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>username</td>
<td>email</td>
<td>password</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>bob</td>
<td>bob</td>
<td>bob</td>
</tr>
<tr class="row">
<td>tom</td>
<td>tom</td>
<td>tom</td>
</tr>
<tr class="row">
<td>fridge</td>
<td>fridge</td>
<td>fridge</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the user "<strong class="passed_param">fridge</strong>" is an admin</span>
<span class="path">Acceptance\Context\Data\DataContext::theUserIsAnAdmin()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-type</strong>" with value "<strong class="passed_param">application/json</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<ul class="tags">
<li>@security</li>
</ul>
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 404 when no user exists</span>
<span class="path">features/post-card.feature:14</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/missing/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="passed_param">404</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:404,
    &quot;message&quot;:&quot;&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">no cards should exist in the system</span>
<span class="path">Acceptance\Context\Data\DataContext::noCardsShouldExistInTheSystem()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 402 when a token has already been used</span>
<span class="path">features/post-card.feature:30</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;Invalid token&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the following cards should exist for user "<strong class="passed_param">bob</strong>":</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingCardsShouldExistForUserBob()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>id</td>
<td>number</td>
<td>cardType</td>
<td>expYear</td>
<td>expMonth</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>1</td>
<td>**** **** **** 4242</td>
<td>1</td>
<td>2014</td>
<td>7</td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when trying to add a card for another user (if not admin)</span>
<span class="path">features/post-card.feature:50</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/tom/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;Access Denied&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">no cards should exist in the system</span>
<span class="path">Acceptance\Context\Data\DataContext::noCardsShouldExistInTheSystem()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 201 when trying to add a card for another user (if admin)</span>
<span class="path">features/post-card.feature:66</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">fridge</strong>" with "<strong class="passed_param">fridge</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;card_type_name&quot;:&quot;Visa&quot;,
    &quot;number&quot;:&quot;**** **** **** 4242&quot;,
    &quot;exp_month&quot;:7,
    &quot;exp_year&quot;:2014,
    &quot;id&quot;:1,
    &quot;default&quot;: true
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the following cards should exist for user "<strong class="passed_param">bob</strong>":</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingCardsShouldExistForUserBob()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>id</td>
<td>number</td>
<td>cardType</td>
<td>expYear</td>
<td>expMonth</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>1</td>
<td>**** **** **** 4242</td>
<td>1</td>
<td>2014</td>
<td>7</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the card with id <strong class="passed_param">1</strong> should have been persisted to stripe for user "<strong class="passed_param">bob</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::theCardWithIdShouldHaveBeen()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when not logged in</span>
<span class="path">features/post-card.feature:89</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;Not authenticated&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">no cards should exist in the system</span>
<span class="path">Acceptance\Context\Data\DataContext::noCardsShouldExistInTheSystem()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 400 when no card token has been posted</span>
<span class="path">features/post-card.feature:104</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">POST</strong> request to "<strong class="passed_param">/users/bob/cards</strong>" with body:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithBody()</span>
</div>
<pre class="argument">    {
    }</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">400</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:400,
    &quot;message&quot;:&quot;Request parameter \&quot;token\&quot; is empty&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">no cards should exist in the system</span>
<span class="path">Acceptance\Context\Data\DataContext::noCardsShouldExistInTheSystem()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return 402 when invalid card token has been posted</span>
<span class="path">features/post-card.feature:121</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">POST</strong> request to "<strong class="passed_param">/users/bob/cards</strong>" with body:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithBody()</span>
</div>
<pre class="argument">    {
    &quot;token&quot;: 199
    }</pre>
</li>
<li class="failed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="failed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
<pre class="backtrace">Failed asserting that 500 is identical to 402.</pre>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;Invalid token id: 199&quot;
}</pre>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">no cards should exist in the system</span>
<span class="path">Acceptance\Context\Data\DataContext::noCardsShouldExistInTheSystem()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 201 when a card is successfully created and the user does not have a stripe profile</span>
<span class="path">features/post-card.feature:139</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;card_type_name&quot;:&quot;Visa&quot;,
    &quot;number&quot;:&quot;**** **** **** 4242&quot;,
    &quot;exp_month&quot;:8,
    &quot;exp_year&quot;:2014,
    &quot;id&quot;:1,
    &quot;default&quot;: true
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">exactly <strong class="passed_param">1</strong> stripe profile should have been created for user "<strong class="passed_param">bob</strong>"</span>
<span class="path">Acceptance\Context\Data\DataContext::exactlyStripeProfileShouldHaveBeenCreatedForUser()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the following cards should exist for user "<strong class="passed_param">bob</strong>":</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingCardsShouldExistForUserBob()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>id</td>
<td>number</td>
<td>cardType</td>
<td>expYear</td>
<td>expMonth</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>1</td>
<td>**** **** **** 4242</td>
<td>1</td>
<td>2014</td>
<td>8</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the card with id <strong class="passed_param">1</strong> should have been persisted to stripe for user "<strong class="passed_param">bob</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::theCardWithIdShouldHaveBeen()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 201 when a card is successfully created and the user does have a stripe profile</span>
<span class="path">features/post-card.feature:163</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the following cards should exist for user "<strong class="passed_param">bob</strong>":</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingCardsShouldExistForUserBob()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>id</td>
<td>number</td>
<td>cardType</td>
<td>expYear</td>
<td>expMonth</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>1</td>
<td>**** **** **** 4242</td>
<td>1</td>
<td>2014</td>
<td>8</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>5555 5555 5555 4444</td>
<td>123</td>
<td>03</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;card_type_name&quot;:&quot;MasterCard&quot;,
    &quot;number&quot;:&quot;**** **** **** 4444&quot;,
    &quot;exp_month&quot;:3,
    &quot;exp_year&quot;:2014,
    &quot;id&quot;:2,
    &quot;default&quot;: true
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">exactly <strong class="passed_param">1</strong> stripe profile should have been created for user "<strong class="passed_param">bob</strong>"</span>
<span class="path">Acceptance\Context\Data\DataContext::exactlyStripeProfileShouldHaveBeenCreatedForUser()</span>
</div>
</li>
<li class="failed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the following cards should exist for user "<strong class="failed_param">bob</strong>":</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingCardsShouldExistForUserBob()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>id</td>
<td>number</td>
<td>cardType</td>
<td>expYear</td>
<td>expMonth</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>2</td>
<td>**** **** **** 4444</td>
<td>2</td>
<td>2014</td>
<td>3</td>
</tr>
<tr class="row">
<td>1</td>
<td>**** **** **** 4242</td>
<td>1</td>
<td>2014</td>
<td>8</td>
</tr>
</tbody>
</table>
<pre class="backtrace">Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
 Array (
     0 =&gt; Array (
-        'id' =&gt; '2'
-        'number' =&gt; '**** **** **** 4444'
-        'cardType' =&gt; '2'
-        'expYear' =&gt; '2014'
-        'expMonth' =&gt; '3'
+        'id' =&gt; 1
+        'number' =&gt; '**** **** **** 4242'
+        'cardType' =&gt; 1
+        'expYear' =&gt; 2014
+        'expMonth' =&gt; 8
     )
-    1 =&gt; Array (...)
 )</pre>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">the card with id <strong class="skipped_param">2</strong> should have been persisted to stripe for user "<strong class="skipped_param">bob</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::theCardWithIdShouldHaveBeen()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<ul class="tags">
<li>@card-type</li>
</ul>
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Visa correctly saved</span>
<span class="path">features/post-card.feature:197</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;card_type_name&quot;:&quot;Visa&quot;,
    &quot;number&quot;:&quot;**** **** **** 4242&quot;,
    &quot;exp_month&quot;:8,
    &quot;exp_year&quot;:2014,
    &quot;id&quot;:1,
    &quot;default&quot;: true
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<ul class="tags">
<li>@card-type</li>
</ul>
<h3>
<span class="keyword">Scenario: </span>
<span class="title">MasterCard correctly saved</span>
<span class="path">features/post-card.feature:217</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>5555 5555 5555 4444</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;card_type_name&quot;:&quot;MasterCard&quot;,
    &quot;number&quot;:&quot;**** **** **** 4444&quot;,
    &quot;exp_month&quot;:8,
    &quot;exp_year&quot;:2014,
    &quot;id&quot;:1,
    &quot;default&quot;: true
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<ul class="tags">
<li>@card-type</li>
</ul>
<h3>
<span class="keyword">Scenario: </span>
<span class="title">American Express correctly saved</span>
<span class="path">features/post-card.feature:237</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>378282246310005</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">print response</span>
<span class="path">Acceptance\Context\Web\WebContext::printResponse()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;card_type_name&quot;:&quot;American Express&quot;,
    &quot;number&quot;:&quot;**** ****** *0005&quot;,
    &quot;exp_month&quot;:8,
    &quot;exp_year&quot;:2014,
    &quot;id&quot;:1,
    &quot;default&quot;: true
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<ul class="tags">
<li>@card-type</li>
</ul>
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Discover not supported</span>
<span class="path">features/post-card.feature:258</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>6011111111111117</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;Your card is not supported. Please use a Visa, MasterCard, or American Express card&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">no cards should exist in the system</span>
<span class="path">Acceptance\Context\Data\DataContext::noCardsShouldExistInTheSystem()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<ul class="tags">
<li>@card-type</li>
</ul>
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Diners Club not supported</span>
<span class="path">features/post-card.feature:276</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>30569309025904</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;Your card is not supported. Please use a Visa, MasterCard, or American Express card&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">no cards should exist in the system</span>
<span class="path">Acceptance\Context\Data\DataContext::noCardsShouldExistInTheSystem()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<ul class="tags">
<li>@card-type</li>
</ul>
<h3>
<span class="keyword">Scenario: </span>
<span class="title">JCB not supported</span>
<span class="path">features/post-card.feature:294</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>3530111333300000</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;Your card is not supported. Please use a Visa, MasterCard, or American Express card&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">no cards should exist in the system</span>
<span class="path">Acceptance\Context\Data\DataContext::noCardsShouldExistInTheSystem()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when the user card fails (Card Declined)</span>
<span class="path">features/post-card.feature:311</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4000 0000 0000 0002</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">print response</span>
<span class="path">Acceptance\Context\Web\WebContext::printResponse()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;Your card was declined.&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when the user card fails (Card Declined)</span>
<span class="path">features/post-card.feature:327</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4000 0000 0000 0002</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;Your card was declined.&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when the user card fails (Card Declined)</span>
<span class="path">features/post-card.feature:342</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4000 0000 0000 0127</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;Your card's security code is incorrect.&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when the user card fails (Card Declined)</span>
<span class="path">features/post-card.feature:357</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4000 0000 0000 0069</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;Your card's expiration date is incorrect.&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when the user card fails (Card Declined)</span>
<span class="path">features/post-card.feature:373</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4000 0000 0000 0119</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">402</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:402,
    &quot;message&quot;:&quot;An error occurred while processing your card. Try again in a little bit.&quot;
}</pre>
</li>
</ol>
</div>
</div>
<div class="feature">
<h2>
<span class="keyword">Feature: </span>
<span class="title">POST login_check</span>
</h2>

<div class="scenario background">
<h3>
<span class="keyword">Background: </span>
<span class="path">features/post-login_check.feature:3</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following users exist in the system:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingUsersExistInTheSystem()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>username</td>
<td>email</td>
<td>password</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>bob</td>
<td>bob</td>
<td>bob</td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 200 when user successfully logs in with json</span>
<span class="path">features/post-login_check.feature:8</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-Type</strong>" with value "<strong class="passed_param">application/x-www-form-urlencoded</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">POST</strong> request to "<strong class="passed_param">/security/login</strong>" with body:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithBody()</span>
</div>
<pre class="argument">{
    &quot;_username&quot;: &quot;bob&quot;,
    &quot;_password&quot;: &quot;bob&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">print response</span>
<span class="path">Acceptance\Context\Web\WebContext::printResponse()</span>
</div>
</li>
<li class="failed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="failed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
<pre class="backtrace">Failed asserting that 403 is identical to 200.</pre>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
  &quot;username&quot;: &quot;bob&quot;,
  &quot;email&quot;: &quot;bob&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 200 when user successfully logs in</span>
<span class="path">features/post-login_check.feature:27</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-Type</strong>" with value "<strong class="passed_param">application/x-www-form-urlencoded</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">POST</strong> request to "<strong class="passed_param">/security/login</strong>" with form data:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithFormData()</span>
</div>
<pre class="argument">_username=bob&amp;_password=bob&amp;_remember_me=1</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="passed_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
  &quot;username&quot;: &quot;bob&quot;,
  &quot;email&quot;: &quot;bob&quot;
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when the password is incorrect</span>
<span class="path">features/post-login_check.feature:42</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-Type</strong>" with value "<strong class="passed_param">application/x-www-form-urlencoded</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">POST</strong> request to "<strong class="passed_param">/security/login</strong>" with form data:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithFormData()</span>
</div>
<pre class="argument">_username=bob&amp;_password=ooo&amp;_remember_me=1</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain "<strong class="passed_param">Bad credentials</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContain()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when the username is incorrect</span>
<span class="path">features/post-login_check.feature:51</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-Type</strong>" with value "<strong class="passed_param">application/x-www-form-urlencoded</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">POST</strong> request to "<strong class="passed_param">/security/login</strong>" with form data:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithFormData()</span>
</div>
<pre class="argument">_username=ooo&amp;_password=bob&amp;_remember_me=1</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain "<strong class="passed_param">Bad credentials</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContain()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when the username and password is incorrect</span>
<span class="path">features/post-login_check.feature:60</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-Type</strong>" with value "<strong class="passed_param">application/x-www-form-urlencoded</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">POST</strong> request to "<strong class="passed_param">/security/login</strong>" with form data:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithFormData()</span>
</div>
<pre class="argument">_username=ooo&amp;_password=ooo&amp;_remember_me=1</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response code should be <strong class="passed_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain "<strong class="passed_param">Bad credentials</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContain()</span>
</div>
</li>
</ol>
</div>
</div>
<div class="feature">
<ul class="tags">
<li>@user</li>
<li>@subscription</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">POST post_user_subscription</span>
</h2>

<div class="scenario background">
<h3>
<span class="keyword">Background: </span>
<span class="path">features/post-user-subscribe.feature:4</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following users exist in the system:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingUsersExistInTheSystem()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>username</td>
<td>email</td>
<td>password</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>bob</td>
<td>bob</td>
<td>bob</td>
</tr>
<tr class="row">
<td>tom</td>
<td>tom</td>
<td>tom</td>
</tr>
<tr class="row">
<td>fridge</td>
<td>fridge</td>
<td>fridge</td>
</tr>
</tbody>
</table>
</li>
<li class="failed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the following subscriptions exist:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingSubscriptionsExist()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>name</td>
<td>description</td>
<td>price</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>small</td>
<td>smallest</td>
<td>100</td>
</tr>
</tbody>
</table>
<pre class="backtrace">No such plan: 1</pre>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">the user "<strong class="skipped_param">fridge</strong>" is an admin</span>
<span class="path">Acceptance\Context\Data\DataContext::theUserIsAnAdmin()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="skipped_param">Content-type</strong>" with value "<strong class="skipped_param">application/json</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 201 when the user has a default card and successfully subscribes to a subscription</span>
<span class="path">features/post-user-subscribe.feature:16</span>
</h3>
<ol>
<li class="skipped">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="skipped_param">bob</strong>" with "<strong class="skipped_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>07</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a POST request to "<strong class="skipped_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="skipped_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="skipped_param">POST</strong> request to "<strong class="skipped_param">/users/bob/subscriptions</strong>" with body:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithBody()</span>
</div>
<pre class="argument">{
    &quot;subscription&quot;: &quot;small&quot;
}</pre>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="skipped_param">200</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json (with subscription_start and subscription_end replaced with todays date):</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJsonWithSubscriptionStartAndSubscriptionEndReplacedWithTodaysDate()</span>
</div>
<pre class="argument">{
    &quot;username&quot;:&quot;bob&quot;,
    &quot;email&quot;:&quot;bob&quot;,
    &quot;stripe_profile&quot;:{
        &quot;subscription_start&quot;:&quot;REPLACED&quot;,
        &quot;subscription_end&quot;:&quot;REPLACED&quot;,
        &quot;default_card_id&quot;:1,
        &quot;subscription&quot;:{
            &quot;name&quot;:&quot;small&quot;,
            &quot;price&quot;:&quot;100&quot;,
            &quot;description&quot;:&quot;smallest&quot;
        },
        &quot;cards&quot;: [{
            &quot;card_type_name&quot;:&quot;Visa&quot;,
            &quot;number&quot;:&quot;**** **** **** 4242&quot;,
            &quot;exp_month&quot;:7,
            &quot;exp_year&quot;:2014,
            &quot;id&quot;:1,
            &quot;default&quot;: true
        }]
    }
}</pre>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 403 when the user has no cards</span>
<span class="path">features/post-user-subscribe.feature:56</span>
</h3>
<ol>
<li class="skipped">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="skipped_param">tom</strong>" with "<strong class="skipped_param">tom</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="skipped_param">POST</strong> request to "<strong class="skipped_param">/users/tom/subscriptions</strong>" with body:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithBody()</span>
</div>
<pre class="argument">{
    &quot;subscription&quot;: &quot;small&quot;
}</pre>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="skipped_param">403</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="skipped">
<div class="step">
<span class="keyword">And </span>
<span class="text">the response should contain json:</span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseShouldContainJson()</span>
</div>
<pre class="argument">{
    &quot;code&quot;:403,
    &quot;message&quot;:&quot;User has no selected card&quot;
}</pre>
</li>
</ol>
</div>
</div>
<div class="feature">
<ul class="tags">
<li>@card</li>
</ul>
<h2>
<span class="keyword">Feature: </span>
<span class="title">PUT put_user_card</span>
</h2>

<div class="scenario background">
<h3>
<span class="keyword">Background: </span>
<span class="path">features/put-card.feature:4</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">the following users exist in the system:</span>
<span class="path">Acceptance\Context\Data\DataContext::theFollowingUsersExistInTheSystem()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>username</td>
<td>email</td>
<td>password</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>bob</td>
<td>bob</td>
<td>bob</td>
</tr>
<tr class="row">
<td>john</td>
<td>john</td>
<td>john</td>
</tr>
<tr class="row">
<td>fridge</td>
<td>fridge</td>
<td>fridge</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">the user "<strong class="passed_param">fridge</strong>" is an admin</span>
<span class="path">Acceptance\Context\Data\DataContext::theUserIsAnAdmin()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I set header "<strong class="passed_param">Content-type</strong>" with value "<strong class="passed_param">application/json</strong>"</span>
<span class="path">Acceptance\Context\Web\WebContext::iSetHeaderWithValue()</span>
</div>
</li>
</ol>
</div>
<div class="scenario">
<h3>
<span class="keyword">Scenario: </span>
<span class="title">Will return a 201 when a card is successfully made default</span>
<span class="path">features/put-card.feature:13</span>
</h3>
<ol>
<li class="passed">
<div class="step">
<span class="keyword">Given </span>
<span class="text">I am authenticating as "<strong class="passed_param">bob</strong>" with "<strong class="passed_param">bob</strong>" password</span>
<span class="path">Acceptance\Context\Web\WebContext::iAmAuthenticatingAs()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">the response code should be <strong class="passed_param">201</strong></span>
<span class="path">Acceptance\Context\Web\WebContext::theResponseCodeShouldBe()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I generate a stripe token from the following card details:</span>
<span class="path">Acceptance\Context\Web\WebContext::iGenerateAStripeTokenFromTheFollowingCardDetails()</span>
</div>
<table class="argument">
<thead>
<tr class="row">
<td>number</td>
<td>cvc</td>
<td>exp_month</td>
<td>exp_year</td>
</tr>
</thead>
<tbody>
<tr class="row">
<td>4242 4242 4242 4242</td>
<td>123</td>
<td>08</td>
<td>2014</td>
</tr>
</tbody>
</table>
</li>
<li class="passed">
<div class="step">
<span class="keyword">And </span>
<span class="text">I send a POST request to "<strong class="passed_param">/users/bob/cards</strong>" with the generated token</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendAPostRequestToWithTheGeneratedToken()</span>
</div>
</li>
<li class="passed">
<div class="step">
<span class="keyword">When </span>
<span class="text">I send a <strong class="passed_param">PUT</strong> request to "<strong class="passed_param">/users/bob/cards/1</strong>" with body:</span>
<span class="path">Acceptance\Context\Web\WebContext::iSendARequestWithBody()</span>
</div>
<pre class="argument">{
    &quot;card_type_name&quot;: &quot;Visa&quot;,
    &quot;default&quot;: true,
    &quot;exp_month&quot;: 12,
    &quot;exp_year&quot;: 2015,
    &quot;id&quot;: 8,
    &quot;number&quot;: &quot;**** **** **** 4242&quot;
}</pre>
</li>
<li class="passed">
<div class="step">
<span class="keyword">Then </span>
<span class="text">print response</span>
<span class="path">Acceptance\Context\Web\WebContext::printResponse()</span>
</div>
</li>
</ol>
</div>
</div>
<div class="summary failed">
<div class="counters">
<p class="scenarios">
52 scenarios (<strong class="passed">45 passed</strong>, <strong class="failed">7 failed</strong>)
</p>
<p class="steps">
415 steps (<strong class="passed">383 passed</strong>, <strong class="skipped">25 skipped</strong>, <strong class="failed">7 failed</strong>)
</p>
<p class="time">
2m2.774s
</p>
</div>
<div class="switchers">
    <a href="javascript:void(0)" id="behat_show_all">[+] all</a>
    <a href="javascript:void(0)" id="behat_hide_all">[-] all</a>
</div>
</div>

    </div>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('#behat .feature h2').click(function(){
                $(this).parent().toggleClass('jq-toggle-opened');
            }).parent().addClass('jq-toggle');

            $('#behat .scenario h3').click(function(){
                $(this).parent().toggleClass('jq-toggle-opened');
            }).parent().addClass('jq-toggle');

            $('#behat_show_all').click(function(){
                $('#behat .feature').addClass('jq-toggle-opened');
                $('#behat .scenario').addClass('jq-toggle-opened');
            });

            $('#behat_hide_all').click(function(){
                $('#behat .feature').removeClass('jq-toggle-opened');
                $('#behat .scenario').removeClass('jq-toggle-opened');
            });

            $('#behat .summary .counters .scenarios .passed')
                .addClass('switcher')
                .click(function(){
                    var $scenario = $('.feature .scenario:not(:has(.failed, .pending))');
                    var $feature  = $scenario.parent();

                    $('#behat_hide_all').click();

                    $scenario.addClass('jq-toggle-opened');
                    $feature.addClass('jq-toggle-opened');
                });

            $('#behat .summary .counters .steps .passed')
                .addClass('switcher')
                .click(function(){
                    var $scenario = $('.feature .scenario:has(.passed)');
                    var $feature  = $scenario.parent();

                    $('#behat_hide_all').click();

                    $scenario.addClass('jq-toggle-opened');
                    $feature.addClass('jq-toggle-opened');
                });

            $('#behat .summary .counters .failed')
                .addClass('switcher')
                .click(function(){
                    var $scenario = $('.feature .scenario:has(.failed)');
                    var $feature = $scenario.parent();

                    $('#behat_hide_all').click();

                    $scenario.addClass('jq-toggle-opened');
                    $feature.addClass('jq-toggle-opened');
                });

            $('#behat .summary .counters .skipped')
                .addClass('switcher')
                .click(function(){
                    var $scenario = $('.feature .scenario:has(.skipped)');
                    var $feature = $scenario.parent();

                    $('#behat_hide_all').click();

                    $scenario.addClass('jq-toggle-opened');
                    $feature.addClass('jq-toggle-opened');
                });

            $('#behat .summary .counters .pending')
                .addClass('switcher')
                .click(function(){
                    var $scenario = $('.feature .scenario:has(.pending)');
                    var $feature = $scenario.parent();

                    $('#behat_hide_all').click();

                    $scenario.addClass('jq-toggle-opened');
                    $feature.addClass('jq-toggle-opened');
                });
        });
    </script>
</body>
</html>
